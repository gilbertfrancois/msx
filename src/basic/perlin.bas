100 ' Perlin noise generator
110 ' Gilbert Francois Duivesteijn
120 '
198 NX=2: NY=2
199 PI=4*ATN(1)
200 DIM GX(NX+1,NY+1): ' random grid x
201 DIM GY(NX+1,NY+1): ' random grid y
210 GOSUB 2000
220 PRINT STR$(GX(1,1))
230 X=7: Y=5: V=0: GOSUB 6000
240 PRINT V
300 COLOR 1,15,15:CLS
310 SCREEN 2
320 FOR I=0 TO 255 STEP 8
330 FOR J=0 TO 191 STEP 8
340 X=I: Y=J: GOSUB 6000
350 X1=COS(V): Y1=SIN(V)
360 LINE(X,Y)-(X+X1*5, Y+Y1*5),1
370 NEXT J
380 NEXT I
390 GOTO 390
999 END
2000 '
2010 ' Generate random gradient
2020 ' in:  RG
2030 ' out: RG
2040 '
2045 PRINT "[i] Generating random gradient."
2046 T0=TIME
2050 FOR I=0 TO NX+1
2060 FOR J=0 TO NY+1
2070 PHI=RND(TIME)*2*PI
2071 GX(I,J) = COS(PHI)
2072 GY(I,J) = SIN(PHI)
2080 NEXT J
2090 NEXT I
2095 T1=TIME
2096 PRINT "    Done, " + STR$((T1-T0)/50) + " sec."
3000 RETURN
4000 '
4010 ' Dot gradient
4020 ' in:  x,ix,y,iy,gx,gy
4030 ' out: dg
4040 '
4050 DX = X - IX*(256/NX)
4060 DY = Y - IY*(192/NY)
4070 DG=DX*GX(IX,IY) + DY*GY(IX,IY)
4080 RETURN
5000 '
5010 ' Interpolate
5020 ' in:  n0,n1,w
5030 ' out: n2
5040 '
5050 N2=(N1-N0)*W+N0
5060 RETURN
6000 '
6010 ' Perlin noise
6020 ' in:  a0,a1,w
6030 ' out: v
6040 '
6050 X0=CINT(X/(256/NX)): X1=X0+1
6060 Y0=CINT(Y/(192/NY)): Y1=Y0+1
6070 IX=X0: IY=Y0: GOSUB 4000
6080 N0=DG
6090 IX=X1: IY=Y0: GOSUB 4000
6100 N1=DG
6110 W=X-X0: GOSUB 5000
6120 M0=N2
6130 IX=X0: IY=Y1: GOSUB 4000
6140 N0=DG
6150 IX=X1: IY=Y1: GOSUB 4000
6160 N1=DG
6170 W=X-X0: GOSUB 5000
6180 M1=N2
6190 N0=M0: N1=M1
6200 W=Y-Y0: GOSUB 5000
6210 V=N2
6220 RETURN
